angular.module("Foodees",["ngResource","ngMessages","ngAnimate","toastr","ui.router","satellizer","ui.bootstrap","angularMoment","afklStickyElement","ngAside","ngSanitize"]).config(["$stateProvider","$urlRouterProvider","$authProvider","$locationProvider",function(e,t,r){var a=["$q","$location","$auth",function(e,t,r){var a=e.defer();return r.isAuthenticated()?t.path("/dashboard"):a.resolve(),a.promise}],l=["$q","$location","$auth",function(e,t,r){var a=e.defer();return r.isAuthenticated()?a.resolve():t.path("/login"),a.promise}];e.state("app",{url:"","abstract":!0,views:{header:{templateUrl:"views/includes/header.html",controller:"HeaderCtrl"},footer:{templateUrl:"views/includes/_footer/_footer.html",controller:"FooterCtrl"}}}).state("app.home",{url:"/",views:{"container@":{controller:"HomeCtrl",templateUrl:"views/home.html"}},resolve:{skipIfLoggedIn:a}}).state("app.style",{url:"/style",views:{"container@":{controller:"HomeCtrl",templateUrl:"views/style.html"}}}).state("app.press",{url:"/press",views:{"container@":{templateUrl:"views/press.html",controller:"PressCtrl"}}}).state("app.tiffinservicemenu",{url:"/tiffinservicemenu",views:{"container@":{templateUrl:"views/tiffinservice.html",controller:"TiffinCtrl"}}}).state("app.login",{url:"/login",views:{"container@":{templateUrl:"views/login.html",controller:"LoginCtrl"}},resolve:{skipIfLoggedIn:a}}).state("app.signup",{url:"/signup",views:{"container@":{templateUrl:"views/signup.html",controller:"SignupCtrl"}},resolve:{skipIfLoggedIn:a}}).state("app.forgot-password",{url:"/forgot-password",views:{"container@":{templateUrl:"views/forgot-password.html",controller:"ForgotPasswordCtrl"}},resolve:{skipIfLoggedIn:a}}).state("app.signup.profile",{url:"/profile",views:{"":{templateUrl:"views/signup/profile.html"}},resolve:{skipIfLoggedIn:a}}).state("app.signup.statistics",{url:"/statistics",views:{"":{templateUrl:"views/signup/statistics.html"}},resolve:{skipIfLoggedIn:a}}).state("app.profile",{url:"/profile",views:{"container@":{templateUrl:"views/profile.html",controller:"ProfileCtrl"}},resolve:{loginRequired:l}}).state("app.admin",{url:"/admin",views:{"container@":{templateUrl:"views/admin.html",controller:"AdminCtrl"}},resolve:{loginRequired:l}}).state("app.admin.item",{url:"/item",views:{"container@":{templateUrl:"views/admin/item.html",controller:"AdminCtrl"}},resolve:{loginRequired:l}}).state("app.admin.menu",{url:"/menu",views:{"container@":{templateUrl:"views/admin/menu.html",controller:"AdminCtrl"}},resolve:{loginRequired:l}}).state("app.myorders",{url:"/myorders",views:{"container@":{templateUrl:"views/orders.html",controller:"OrdersCtrl"}},resolve:{loginRequired:l}}).state("app.mypayments",{url:"/mypayments",views:{"container@":{templateUrl:"views/payments.html",controller:"PaymentsCtrl"}},resolve:{loginRequired:l}}).state("app.dashboard",{url:"/dashboard",views:{"container@":{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}},resolve:{loginRequired:l}}).state("app.cart",{url:"/cart",views:{"container@":{templateUrl:"views/cart.html",controller:"CartCtrl"}},resolve:{loginRequired:l}}).state("app.cart.address",{url:"/address",views:{"":{templateUrl:"views/cart/address.html"}},resolve:{loginRequired:l}}).state("app.checkout",{url:"/checkout",views:{"container@":{templateUrl:"views/checkout.html",controller:"CheckoutCtrl"}},resolve:{loginRequired:l}}).state("app.cart.payment",{url:"/payment",views:{"":{templateUrl:"views/cart/payment.html"}},resolve:{loginRequired:l}}).state("app.payment",{url:"/payment",views:{"container@":{templateUrl:"views/payment.html",controller:"PaymentCtrl"}},resolve:{loginRequired:l}}).state("app.payment.failed",{url:"/failed",views:{"":{templateUrl:"views/payment/failed.html"}},resolve:{loginRequired:l}}).state("app.payment.success",{url:"/success",views:{"":{templateUrl:"views/payment/success.html"}},resolve:{loginRequired:l}}),t.otherwise("/"),r.loginUrl="/auth/login",r.signupUrl="/auth/signup",r.facebook({url:"/auth/facebook",clientId:"631388166902710"})}]).run(["$rootScope","$state","$stateParams","$window",function(e){e.order={},e.plan={}}]);var Foodees=Foodees||{};Date.prototype.addDays=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t};var holidays=["7/4/2017","8/9/2017"];Foodees.util={isHoliday:function(e){var t=!1,r=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear();return holidays.forEach(function(e){var a=new Date(e);e=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear(),e===r&&(t=!0)}),t},saveLocalStorage:function(e,t,r){if("undefined"==typeof Storage)return!1;var a={value:JSON.stringify(t),timestamp:(new Date).getTime()+r};return localStorage.setItem(e,JSON.stringify(a)),t},loadLocalStorage:function(e){if("undefined"==typeof Storage)return!1;var t=JSON.parse(localStorage.getItem(e));return t?(new Date).getTime()<t.timestamp&&JSON.parse(t.value):!1},findClosest:function(e,t){var r=t.map(function(t){return Math.abs(t-e)}),a=Math.min.apply(Math,r);return t[r.indexOf(a)]<e?t[r.indexOf(a)+1]:t[r.indexOf(a)]},getEndDate:function(){{var e=new Date,t=e.getDay(),r=e.getDate();e.getHours()}return r=0==t?r+6:r+6-t,new Date(e.setDate(r))},getStartDate:function(e){var t=new Date,r=t.getDay(),a=(t.getDate(),t.getHours());return 0==r?t=t.addDays(1):(a>=4&&"lunch"==e?t=t.addDays(1):a>=16&&"dinner"==e&&(t=t.addDays(1)),t)},findDateIndex:function(e,t){var r=0;return t.forEach(function(t,a){e.getDate()==t.getDate()&&(r=a)}),r},getFullDateFormatted:function(e){var t=e.getFullYear()+"-";return t+=e.getMonth()+1,t+="-"+e.getDate()},getDateFormatted:function(e){return("0"+e.getDate()).slice(-2)},getDateWithOrdinal:function(e){e=e.getDate();var t=("0"+e).slice(-2)+(31==e||21==e||1==e?"st":22==e||2==e?"nd":23==e||3==e?"rd":"th");return t},getDates:function(e,t){for(var r=new Array,a=e;t>=a;)r.push(a),a=a.addDays(1);return r},calculateMealDeliveryCost:function(e){var t=[];t.ContainerA=0,t.ContainerB=0,t.ContainerC=0,t.BreadContainer=0,e.menus.forEach(function(e){e.items.forEach(function(e){t[e.containerType]+=e.quantity/e.defaultQuantity*e.container})});var r=t.ContainerB,a=Number((t.ContainerA/4).toFixed(2).toString().split(".")[0]),l=Number("."+(t.ContainerA/4).toFixed(2).toString().split(".")[1]),n=t.BreadContainer/2;return a>=n?(n=0,a+=l,a=Math.ceil(a)):(n-=a,n+=l,n=Math.ceil(n/2)),30*(a+r+n)}};
angular.module("Foodees").controller("AddressCtrl",["$location","$scope","$auth","toastr","$uibModalInstance","Address","Area",function(e,s,a,o,c,n,d){s.address={city:"Mumbai"},s.areas=d.query({mealType:s.activeMealType}),s.ok=function(){n.save(s.address,function(e){s.addresses.push(e),c.close()})},s.cancel=function(){c.dismiss("cancel")}}]);
angular.module("Foodees").controller("AdminCtrl",["$scope","$location","$auth","toastr","Item","Menu",function(e,n,a,m,t,u){var i=0;e.disable=!1,e.mnames=["Pasta Veg","Pasta Non-Veg","Classic Indian Veg","Classic Indian Non-Veg","Roasted Veg","Roasted Fish","Salad Veg","Salad Non-Veg","Roasted Chicken","Special Veg","Special Non-Veg","Special Non-Veg","Sandwich Veg","Sandwich Non-Veg","Burger Veg","Burger Non-Veg"],e.menu={},e.menu.name=e.mnames[i],e.mcategories=["Special","Classic Indian","Salad","Pasta","Sandwich","Burger","Roasted"],e.mtypes=["Veg","Non-Veg"],e.mdates=["2017-01-23T00:00:00.000Z","2017-01-24T00:00:00.000Z","2017-01-25T00:00:00.000Z","2017-01-26T00:00:00.000Z","2017-01-27T00:00:00.000Z","2017-01-28T00:00:00.000Z"],e.itemSubmit=function(){e.disable=!0,item.$save(function(){e.item1=e.item2=e.item3=e.item4=e.item5={}})};var r,o,c,s,g;e.$watch("menu.name",function(){var n=e.menu.name.split(" ");console.log(n.length),e.menu.type=n[n.length-1];var a=e.menu.type;"Chicken"==a||"Fish"==a?(a="Non-Veg",e.menu.type="Non-Veg"):"Paneer"==a&&(a="Veg",e.menu.type="Veg"),e.menu.category=n.length>2?n[0]+" "+n[1]:n[0],e.menu.category==e.mcategories[0]?(r=o=c=s=g="",e.menu.orderBy=4):e.menu.category==e.mcategories[1]?(r="Sabzi",o="Dal",c="Rice",s="Bread",g="",e.menu.orderBy=5):e.menu.category==e.mcategories[2]?(r="Salad",o="",c="",s="",g="",e.menu.orderBy=0):e.menu.category==e.mcategories[3]?(r="Italian",o="Bread",c="",s="",g="",e.menu.orderBy=2):e.menu.category==e.mcategories[4]?(r="Sandwich",o="",c="",s="",g="",e.menu.orderBy=1):e.menu.category==e.mcategories[5]?(r="Burger",o="",c="",s="",g="",e.menu.orderBy=1):e.menu.category==e.mcategories[6]&&(r="Baked",o="",c="",s="",g="",e.menu.orderBy=3),e.items1=t.query({type:a,category:r}),e.items2=t.query({category:o}),e.items3=t.query({category:c}),e.items4=t.query({category:s}),e.items5=t.query({category:g})}),e.menuSubmitLunch=function(){i++;for(var n in e.menu.items)null==e.menu.items[n]&&delete e.menu.items[n];e.menu.mealType="Lunch";var a=new u(e.menu);a.$save(function(){})},e.menuSubmitDinner=function(){i++,console.log(e.menu);for(var n in e.menu.items)null==e.menu.items[n]&&delete e.menu.items[n];e.menu.mealType="Dinner";var a=new u(e.menu);a.$save(function(){})},e.menuSubmitDinnerLunch=function(){i++,console.log(e.menu);for(var n in e.menu.items)null==e.menu.items[n]&&delete e.menu.items[n];e.menu.mealType="Dinner";var a=new u(e.menu);a.$save(function(){}),e.menu.mealType="Lunch";var m=new u(e.menu);m.$save(function(){})},e.items=t.query()}]);
angular.module("Foodees").controller("CartCtrl",["$scope","$rootScope","$state","$location","$http","$auth","toastr","$uibModal","Address","Account","Order",function(e,r,d,s,t,a,o,c,n,l,i){if(null===localStorage.getItem("fdsOrder"))return d.go("app.dashboard");e.order=JSON.parse(localStorage.getItem("fdsOrder")),e.isOrder=!0,l.getProfile().then(function(r){e.user=r.data}).catch(function(e){o.error(e.data.message,e.status)}),e.order=i.get({_id:e.order._id},function(d){r.order=e.order=d}),e.address={},e.addresses=n.query(function(r){e.addresses=r,e.selectedAddress=r[0],e.order.address=e.selectedAddress._id}),e.addAddress=function(){e.addressTitle="Add New Address",e.newAddress=!0},e.selectAddress=function(r){e.newAddress=!1,e.selectedAddress=r,e.address=r,e.order.address=e.selectedAddress._id},e.addresses=[],e.newAddress=!0,e.addressTitle="Add New Address",e.editAddress=function(r){e.address=r},e.saveAddress=function(){n.save(e.address,function(r){e.addresses.push(r),e.selectedAddress=r,e.order.address=r._id,e.address={},e.newAddress=!0})},e.delAddress=function(e){e.$delete(1,function(){o.success("Address removed")})},e.checkout=function(){e.order.address?(e.order.address=e.selectedAddress._id,e.order.status="checkout",r.order=e.order,i.update(e.order,function(d){r.order=e.order=d,t.post("/api/pay",e.order).then(function(r){console.log(r),"amount-missing"==r.data.status?o.error("Server error. Please contact the admin"):"recharge-required"==r.data.status?e.rechargeModal("sm"):"order-placed"==r.data.status?(localStorage.removeItem("fdsOrder"),s.url("/dashboard?payment=success&txn="+r.data.data.transaction.txid+"&orderid="+r.data.data.order._id)):o.success(r.data.message)}).catch(function(e){o.error(e.data.message,e.status)})})):o.error("No address selected")};var u=this;e.rechargeModal=function(e,r){{var d=r?angular.element($document[0].querySelector(".modal-demo "+r)):void 0;c.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/includes/_modal/recharge.html",controller:"RechargeCtrl",controllerAs:"$recharge",size:"md",appendTo:d,resolve:{items:function(){return u.items}}})}}}]).controller("CheckoutCtrl",["$scope","$rootScope","$state","$location","$http","$auth","toastr","Address","Account","Order",function(e,r,d){return null===localStorage.getItem("fdsOrder")?d.go("app.dashboard"):void(e.order=JSON.parse(localStorage.getItem("fdsOrder")))}]);
angular.module("Foodees").controller("DashboardCtrl",["$scope","$rootScope","$state","$auth","toastr","moment","Menu","Account","Transaction","Order","$uibModal","Address","$window","$sce","$location",function(e,t,a,o,n,r,s,d,l,c,u,g,m,f,y){localStorage.removeItem("foodeesOrder"),e.util=Foodees.util;var p=this;e.paymentModal=function(e,t){{var a=t?angular.element($document[0].querySelector(".modal-demo "+t)):void 0;u.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/includes/_modal/payment.html",controller:"PaymentCtrl",controllerAs:"$payment",size:"sm",appendTo:a,resolve:{items:function(){return p.items}}})}},"undefined"!=typeof y.search().payment&"undefined"!=typeof y.search().txn&&(e.paymentStatus=y.search().payment,e.txn=y.search().txn,e.paymentModal("sm")),l.getWalletAmount().then(function(t){e.balance=t.data.balance}),l.getTransactions().then(function(t){e.transactions=t.data});e.lunchDates=Foodees.util.getDates(Foodees.util.getStartDate("lunch"),Foodees.util.getEndDate());e.days=["Sat","Mon","Tue","Wed","Thu","Fri","Sat"],e.months=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sep","Oct","Nov","Dec"],e.dinnerDates=Foodees.util.getDates(Foodees.util.getStartDate("dinner"),Foodees.util.getEndDate()),e.lunchDates.length>0?(e.dates=e.lunchDates,e.selectedDate=e.dates[0],e.activeMealType="Lunch"):e.dinnerDates.length>0&&(e.dates=e.dinnerDates,e.selectedDate=e.dates[0],e.activeMealType="Dinner"),d.getProfile().then(function(t){e.user=t.data}).catch(function(e){n.error(e.data.message,e.status)}),d.getPendingOrders().then(function(t){e.orderHistory=t.data,console.log(t.data)}).catch(function(e){n.error(e.data.message,e.status)}),e.activeMenuTypes=[],e.activeCategories=[],e.addresses=[];var h={meals:[],subTotal:0,packagingCost:0,deliveryCost:0,total:0};e.order=null!==localStorage.getItem("fdsOrder")?JSON.parse(localStorage.getItem("fdsOrder")):h,e.getAddresses=function(){g.query({mealType:e.activeMealType}).$promise.then(function(t){e.addresses=t,e.selectedAddress=e.addresses[0]})},e.getMenus=function(){e.menus=s.query({date:Foodees.util.getFullDateFormatted(e.selectedDate),mealType:e.activeMealType,type:e.activeMenuTypes,category:e.activeCategories})},e.dinnerDates.length>0&&e.lunchDates.length>0?(e.getMenus(),e.getAddresses()):e.dinnerDates.length>0&&0==e.lunchDates.length?(e.getMenus(),e.getAddresses(),e.message="We will update menu for next week by Sunday afternoon and Dinner order for Saturday closed after 4pm."):e.message="We will update menu for next week by Sunday afternoon and Dinner order for Saturday closed after 4pm.",e.changeSelectedDate=function(t){e.selectedDate=t,e.getMenus(),n.info("You have selected "+e.activeMealType+" for "+Foodees.util.getDateWithOrdinal(e.selectedDate)+" "+e.months[e.selectedDate.getMonth()])},e.setMealType=function(t){if("Lunch"==t&&e.lunchDates.length>0?e.dates=e.lunchDates:"Dinner"==t&&e.dinnerDates.length>0&&(e.dates=e.dinnerDates),e.dinnerDates.length>0&&e.lunchDates.length>0){var a=Foodees.util.findDateIndex(e.selectedDate,e.dates);e.selectedDate=e.dates[a],e.activeMealType=t,n.info("You have selected "+e.activeMealType+" for "+Foodees.util.getDateWithOrdinal(e.selectedDate)+" "+e.months[e.selectedDate.getMonth()]),e.getMenus(),e.getAddresses()}else if(e.dinnerDates.length>0&&0==e.lunchDates.length){var a=Foodees.util.findDateIndex(e.selectedDate,e.dates);e.selectedDate=e.dates[a],e.activeMealType=t,n.info("You have selected "+e.activeMealType+" for "+Foodees.util.getDateWithOrdinal(e.selectedDate)+" "+e.months[e.selectedDate.getMonth()]),e.getMenus(),e.getAddresses(),e.message="We will update menu for next week by Sunday afternoon and Dinner order for Saturday closed after 4pm."}else e.message="We will update menu for next week by Sunday afternoon and Dinner order for Saturday closed after 4pm."},e.clearFilter=function(){n.info("Filter cleared."),e.activeCategories=[],e.activeMenuTypes=[],e.getMenus();var t=angular.element(document.getElementsByClassName("dropdown-item"));t.removeClass("active")},e.filterType=function(t){var a=!1;e.activeMenuTypes.forEach(function(e,o,r){e==t&&(r.splice(o,1),n.info(t+" removed as filter."),a=!0)}),a||e.activeMenuTypes.push(t),n.info(t+" added as filter."),e.getMenus()},e.filterCategory=function(t){var a=!1;e.activeCategories.forEach(function(e,o,r){e==t&&(r.splice(o,1),n.info(t+" removed as filter."),a=!0)}),a||e.activeCategories.push(t),n.info(t+" added as filter"),e.getMenus()},e.addToCart=function(t){var a=angular.copy(t),o=0,r=0,s=!1,d=angular.copy(a.items);for(i in d)d[i].variation&&(a.selectedVariation="undefined"==typeof a.selectedVariation?0:parseInt(a.selectedVariation),d[i].cost=d[i].variation[a.selectedVariation].cost,d[i].quantity=d[i].variation[a.selectedVariation].container);if(d.forEach(function(e){e.variation?o=e.cost:o+=e.cost/e.defaultQuantity*e.quantity,r+="BreadContainer"==e.containerType?Math.ceil(e.quantity/e.defaultQuantity)*e.container*e.containerCost:e.quantity/e.defaultQuantity*e.container*e.containerCost}),a.items=d,a.packagingCost=r,a.cost=o,e.order.meals.forEach(function(t){new Date(t.date).getTime()===new Date(a.date).getTime()&&t.mealType===a.mealType&&t.address===e.selectedAddress&&(t.menus.push(a),t.subTotal+=a.cost,t.packagingCost+=r,t.deliveryCost=Foodees.util.calculateMealDeliveryCost(t),s=!0)}),!s){var l={date:a.date,mealType:a.mealType,menus:[a],subTotal:a.cost,packagingCost:a.packagingCost,address:angular.copy(e.selectedAddress)};l.deliveryCost=Foodees.util.calculateMealDeliveryCost(l),e.order.meals.push(l)}e.order.packagingCost=0,e.order.deliveryCost=0,e.order.subTotal=0,e.order.meals.forEach(function(t){e.order.packagingCost+=t.packagingCost,e.order.deliveryCost+=t.deliveryCost,e.order.subTotal+=t.subTotal}),n.success("Item added to the cart."),e.order.total=e.order.subTotal+e.order.packagingCost+e.order.deliveryCost,localStorage.setItem("fdsOrder",JSON.stringify(e.order))},e.removeMenu=function(t,a){e.order.meals[t].menus.splice(a,1),e.order.packagingCost=0,e.order.deliveryCost=0,e.order.subTotal=0,e.order.meals[t].menus.length<=0&&e.order.meals.splice(t,1),e.order.meals.forEach(function(t){t.packagingCost=0,t.subTotal=0,t.menus.forEach(function(e){var a=0,o=0;e.items.forEach(function(e){a+=e.cost/e.defaultQuantity*e.quantity,o+="BreadContainer"==e.containerType?Math.ceil(e.quantity/e.defaultQuantity)*e.container*e.containerCost:e.quantity/e.defaultQuantity*e.container*e.containerCost}),e.packagingCost=o,e.cost=a,t.packagingCost+=e.packagingCost,t.subTotal+=e.cost}),t.deliveryCost=Foodees.util.calculateMealDeliveryCost(t),e.order.packagingCost+=t.packagingCost,e.order.deliveryCost+=t.deliveryCost,e.order.subTotal+=t.subTotal}),n.success("Item removed from cart."),e.order.total=e.order.subTotal+e.order.packagingCost+e.order.deliveryCost,localStorage.setItem("fdsOrder",JSON.stringify(e.order))},e.add=function(e){e.quantity++},e.subtract=function(e){e.quantity>0&&e.quantity--},e.getCost=function(e){var t=e.items,a=0;for(i in t)t[i].variation?("undefined"==typeof e.selectedVariation&&(e.selectedVariation=1),a+=t[i].variation[e.selectedVariation].cost):a+=t[i].cost/t[i].defaultQuantity*t[i].quantity;return a},e.getTotalContainer=function(e){var t=0;for(i in e)t+=e[i].defaultQuantity;return t},e.processCart=function(){var o=new c(e.order);o.$save().then(function(o){e.order=o,localStorage.setItem("fdsOrder",JSON.stringify(e.order)),t.order=e.order,a.go("app.cart.address")}).catch(function(e){n.error(e.data.message,e.status)})};var v=this;e.rechargeModal=function(e,t){{var a=t?angular.element($document[0].querySelector(".modal-demo "+t)):void 0;u.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/includes/_modal/recharge.html",controller:"RechargeCtrl",controllerAs:"$recharge",size:"md",appendTo:a,resolve:{items:function(){return v.items}}})}};var D=this;e.addAddressModal=function(t,a){{var o=a?angular.element($document[0].querySelector(".modal-demo "+a)):void 0;u.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"views/includes/_modal/addAddress.html",controller:"AddressCtrl",controllerAs:"$addAddress",size:"md",scope:e,appendTo:o,resolve:{items:function(){return D.items}}}).closed.then(function(){e.getAddresses()})}};var C=angular.element(m);C.on("scroll",function(){console.log("Hello")})}]);
angular.module("Foodees").controller("FooterCtrl",["$scope","$auth","$window","$http","toastr",function(t,o,e,n,i){t.isAuthenticated=function(){return o.isAuthenticated()},t.openLink=function(t){e.open(t)},t.subscribe=function(){var o={email:t.email,list:"zMKOlDeHsgM1tDm7639jAfLg","boolean":!0};n.post("http://marketing.foodees.in/subscribe",o).then(function(t){console.log(t)}).catch(function(t){console.log(t),i.error(t.data.message,t.status)})}}]);
angular.module("Foodees").controller("ForgotPasswordCtrl",["$scope","$rootScope","$state","$location","$auth","toastr","Account",function(o,t,s,a,r,e,c){o.forgotPassword=function(){c.forgotPassword(o.user).then(function(o){"forgot-password"==o.data.status&&e.success(o.data.message,o.status)}).catch(function(o){e.error(o.data.message,o.status)})}}]);
angular.module("Foodees").controller("HeaderCtrl",["$scope","$state","$auth","$aside","anchorSmoothScroll","toastr",function(o,e,t,n,i,a){o.isAuthenticated=function(){return t.isAuthenticated()},o.asideState={open:!1},o.openAside=function(t){o.asideState={open:!0,position:t},n.open({templateUrl:"views/includes/aside.html",placement:"left",size:"lg",controller:["$scope","$uibModalInstance",function(o,t){o.ok=function(o){t.close(),o.stopPropagation()},o.cancel=function(o){t.dismiss(),o.stopPropagation()},o.openPage=function(o,n){e.go(n),t.dismiss(),o.stopPropagation()}}]})},o.logout=function(){t.isAuthenticated()&&t.logout().then(function(){localStorage.removeItem("fdsOrder"),a.info("You have been logged out"),e.go("app.home",{},{reload:!0})})}}]);
angular.module("Foodees").controller("HomeCtrl",["$scope","$http","$state","$location","anchorSmoothScroll","$interval",function(t,e,o,n,s){t.items=[{name:"Punjabi Rajma Masala",qty:1,cost:45},{name:"Whole Wheat Roti",qty:1,cost:15},{name:"Dal Makhani",qty:1,cost:10},{name:"Stream Rice",qty:1,cost:15}],t.add=function(e){t.cost+=e.cost,e.qty++},t.subtract=function(e){e.qty>0&&(t.cost-=e.cost,e.qty--)},t.cost=0;for(i in t.items)t.cost=t.cost+t.items[i].cost*t.items[i].qty;var a=new Date;a.setHours(28),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0);var c=(a.getTime()-(new Date).getTime())/1e3,r=new Date(Date.parse(new Date)+1e3*c),l=Date.parse(r)-Date.parse(new Date);t.countdown={},t.countdown.seconds=Math.floor(l/1e3%60),t.countdown.minutes=Math.floor(l/1e3/60%60),t.countdown.hours=Math.floor(l/36e5%24),t.countdown.days=Math.floor(l/864e5),t.switch_1="veg",t.switch_3="nonveg",t.switch_4="chicken",t.switch_5="paneer",t.switch_6="year",t.gotoElement=function(e){console.log("scroll"),t.activeMenu=e,"app.home"!=o.current.name?o.go("app.home").then(function(){setTimeout(function(){n.hash(e),s.scrollTo(e)},200)}):(n.hash(e),s.scrollTo(e))},t.menuItems=["header","process","features","special","clients"],t.activeMenu=t.menuItems[0],t.setActive=function(){}}]);
angular.module("Foodees").controller("LoginCtrl",["$scope","$location","$auth","toastr",function(e,s,t,a){e.login=function(){t.login(e.user).then(function(){a.success("You have successfully signed in!"),s.path("/dashboard")}).catch(function(e){0==e.status?a.error("error.data.message",500):a.error(e.data.message,e.status)})},e.authenticate=function(e){t.authenticate(e).then(function(){a.success("You have successfully signed in with "+e+"!"),s.path("/dashboard")}).catch(function(e){e.message?a.error(e.message):e.data?a.error(e.data.message,e.status):a.error(e)})}}]);
angular.module("Foodees").controller("LogoutCtrl",["$location","$auth","toastr",function(o,t,e){t.isAuthenticated()&&t.logout().then(function(){localStorage.removeItem("fdsOrder"),o.path("/"),e.info("You have been logged out")})}]);
angular.module("Foodees").controller("OrdersCtrl",["$scope","$auth","toastr","Order","$http",function(e,r,t,s,u){e.myorder="current",e.currentOrders=s.query({status:"confirmed"}),e.refundedOrders=s.query({status:"refunded"}),e.completeOrders=s.query({status:"complete"}),e.cancelOrder=function(r){u.post("/api/orders/"+r+"/refund").then(function(r){t.success(r.data.message,r.status),e.currentOrders=s.query({status:"confirmed"}),e.refundedOrders=s.query({status:"refunded"})}).catch(function(e){t.error(e.data.message,e.status)})},e.cancelMeal=function(r){u.post("/api/meals/"+r+"/refund").then(function(r){t.success(r.data.message,r.status),e.currentOrders=s.query({status:"confirmed"}),e.refundedOrders=s.query({status:"refunded"})}).catch(function(e){t.error(e.data.message,e.status)})}}]);
angular.module("Foodees").controller("PaymentsCtrl",["$scope","$auth","toastr","Transaction",function(t,a,o,e){e.getTransactions().then(function(a){t.transactions=a.data}).catch(function(t){o.error(t.data.message,t.status)})}]),angular.module("Foodees").controller("PaymentCtrl",["$scope","$rootScope","$state","$location","$http","$auth","toastr","Address","Account","Order","Transaction","$uibModalInstance",function(t,a,o,e,n,r,s,c,d,i,u,l){t.paymentStatus=e.search().payment,t.txn=e.search().txn,t.orderid=e.search().orderid,t.order=i.get({_id:t.orderid},function(a){t.order=a.status,"confirmed"==t.order.status&&localStorage.removeItem("fdsOrder")}),u.getTransaction(t.txn).then(function(a){t.transaction=a.data}).catch(function(t){s.error(t.data.message,t.status)}),t.cancel=function(){l.close()}}]);
angular.module("Foodees").controller("PressCtrl",["$location","$auth","toastr",function(){}]);
angular.module("Foodees").controller("ProfileCtrl",["$scope","$auth","toastr","Account",function(t,n,e,o){t.getProfile=function(){o.getProfile().then(function(n){t.user=n.data}).catch(function(t){e.error(t.data.message,t.status)})},t.updateProfile=function(){o.updateProfile(t.user).then(function(){e.success("Profile has been updated")}).catch(function(t){e.error(t.data.message,t.status)})},t.link=function(o){n.link(o).then(function(){e.success("You have successfully linked a "+o+" account"),t.getProfile()}).catch(function(t){e.error(t.data.message,t.status)})},t.unlink=function(o){n.unlink(o).then(function(){e.info("You have unlinked a "+o+" account"),t.getProfile()}).catch(function(t){e.error(t.data?t.data.message:"Could not unlink "+o+" account",t.status)})},t.getProfile()}]);
angular.module("Foodees").controller("RechargeCtrl",["$location","$scope","$auth","$http","toastr","$uibModalInstance",function(o,e,t,a,r,s){e.rechargeAmount=[250,1e3,1500,3e3,5e3],"checkout"==e.order.status?(e.amount=Foodees.util.findClosest(e.order.total,e.rechargeAmount),console.log(e.amount),console.log(e.order)):e.amount=1e3,e.ok=function(){console.log(e.order);var o={amount:e.amount};"checkout"==e.order.status&&(o.orderid=e.order._id),a.post("/api/recharge",o).then(function(o){o.data.data?(window.location.href=o.data.data,r.success(o.data.message,o.status)):r.error("We are facing some issue on the server","Error")}).catch(function(o){r.error(o.data.message,o.status)}),s.close()},e.cancel=function(){s.dismiss("cancel")}}]);
angular.module("Foodees").controller("SignupCtrl",["$scope","$rootScope","$state","$location","$auth","toastr","Account",function(e,n,o,t,a,s){e.user={},e.user.sex="male",e.mobilePattern="/^d{10}$/",e.signup=function(){a.signup(e.user).then(function(e){a.setToken(e),t.path("/dashboard"),s.info("You have successfully created a new account and have been signed-in")}).catch(function(e){s.error(e.data.message)})}}]);
angular.module("Foodees").controller("TiffinCtrl",["$scope","$location","$auth","toastr","Menu",function(e){e.util=Foodees.util,e.dates=e.lunchDates=Foodees.util.getDates(new Date("2017/7/17"),Foodees.util.getEndDate()),e.days=["Mon","Tue","Wed","Thu","Fri","Sat"],e.months=["Jan","Feb","Mar","Apr","May","June","July","Aug","Sep","Oct","Nov","Dec"],e.isSubscription=!1,e.selectedDate=e.dates[0],e.activeMealType="Lunch",e.changeSelectedDate=function(t){e.selectedDate=t},e.changeMealType=function(t){e.activeMealType=t}}]);
angular.module("Foodees").directive("aside",[function(o){var n=angular.element(o);return{restrict:"A",link:function(o,e,l){var t=(l.setClassWhenAtTop,e.offset().top);n.on("scroll",function(){n.scrollTop()>=t&&(console.log("offsetTop"),console.log(t),console.log("$win.scrollTop()"),console.log(n.scrollTop()))})}}}]).directive("compile",["$compile",function(o){return function(n,e,l){n.$watch(function(o){return o.$eval(l.compile)},function(l){e.html(l),o(e.contents())(n)})}}]);
angular.module("Foodees").directive("passwordMatch",[function(){return{require:"ngModel",scope:{otherModelValue:"=passwordMatch"},link:function(e,o,a,r){r.$validators.compareTo=function(o){return o===e.otherModelValue},e.$watch("otherModelValue",function(){r.$validate()})}}}]);
angular.module("Foodees").directive("passwordStrength",[function(){return{restrict:"A",require:"ngModel",link:function(e,i,s,o){var t=i.children(),n=Array.prototype.slice.call(t.children()),a=n.slice(-1)[0],r=n.slice(-2),l=n.slice(-3),p=n.slice(-4);i.after(t),i.bind("keyup",function(){var e,i={positive:{},negative:{}},s={positive:{},negative:{}},t=0;angular.forEach(n,function(e){e.style.backgroundColor="#ebeef1"}),o.$viewValue&&(i.positive.lower=o.$viewValue.match(/[a-z]/g),i.positive.upper=o.$viewValue.match(/[A-Z]/g),i.positive.numbers=o.$viewValue.match(/\d/g),i.positive.symbols=o.$viewValue.match(/[$-\/:-?{-~!^_`\[\]]/g),i.positive.middleNumber=o.$viewValue.slice(1,-1).match(/\d/g),i.positive.middleSymbol=o.$viewValue.slice(1,-1).match(/[$-\/:-?{-~!^_`\[\]]/g),s.positive.lower=i.positive.lower?i.positive.lower.length:0,s.positive.upper=i.positive.upper?i.positive.upper.length:0,s.positive.numbers=i.positive.numbers?i.positive.numbers.length:0,s.positive.symbols=i.positive.symbols?i.positive.symbols.length:0,s.positive.numChars=o.$viewValue.length,e+=s.positive.numChars>=8?1:0,s.positive.requirements=e>=3?e:0,s.positive.middleNumber=i.positive.middleNumber?i.positive.middleNumber.length:0,s.positive.middleSymbol=i.positive.middleSymbol?i.positive.middleSymbol.length:0,i.negative.consecLower=o.$viewValue.match(/(?=([a-z]{2}))/g),i.negative.consecUpper=o.$viewValue.match(/(?=([A-Z]{2}))/g),i.negative.consecNumbers=o.$viewValue.match(/(?=(\d{2}))/g),i.negative.onlyNumbers=o.$viewValue.match(/^[0-9]*$/g),i.negative.onlyLetters=o.$viewValue.match(/^([a-z]|[A-Z])*$/g),s.negative.consecLower=i.negative.consecLower?i.negative.consecLower.length:0,s.negative.consecUpper=i.negative.consecUpper?i.negative.consecUpper.length:0,s.negative.consecNumbers=i.negative.consecNumbers?i.negative.consecNumbers.length:0,t+=4*s.positive.numChars,s.positive.upper&&(t+=2*(s.positive.numChars-s.positive.upper)),s.positive.lower&&(t+=2*(s.positive.numChars-s.positive.lower)),(s.positive.upper||s.positive.lower)&&(t+=4*s.positive.numbers),t+=6*s.positive.symbols,t+=2*(s.positive.middleSymbol+s.positive.middleNumber),t+=2*s.positive.requirements,t-=2*s.negative.consecLower,t-=2*s.negative.consecUpper,t-=2*s.negative.consecNumbers,i.negative.onlyNumbers&&(t-=s.positive.numChars),i.negative.onlyLetters&&(t-=s.positive.numChars),t=Math.max(0,Math.min(100,Math.round(t))),t>85?angular.forEach(p,function(e){e.style.backgroundColor="#008cdd"}):t>65?angular.forEach(l,function(e){e.style.backgroundColor="#6ead09"}):t>30?angular.forEach(r,function(e){e.style.backgroundColor="#e09115"}):a.style.backgroundColor="#e01414")})},template:'<span class="password-strength-indicator"><span></span><span></span><span></span><span></span></span>'}}]);
angular.module("Foodees").directive("toggleClass",function(){return{restrict:"A",link:function(e,l,n){l.bind("click",function(){l.toggleClass(n.toggleClass)})}}});
angular.module("Foodees").factory("Account",["$http",function(t){return{getProfile:function(){return t.get("/api/me")},updateProfile:function(e){return t.put("/api/me",e)},isUserRegistered:function(e){return t.post("/auth/email",e)},forgotPassword:function(e){return t.post("/auth/forgot-password",e)},getPendingOrders:function(){return t.get("/api/orders/pending")}}}]);
angular.module("Foodees").factory("Address",["$resource",function(e){return e("/api/addresses/:_id")}]);
angular.module("Foodees").factory("Area",["$resource",function(e){return e("/api/areas/:_id")}]);
angular.module("Foodees").factory("Item",["$resource",function(e){return e("/api/items/:_id")}]);
angular.module("Foodees").factory("Meal",["$resource",function(e){return e("/api/meals/:_id")}]);
angular.module("Foodees").factory("Menu",["$resource",function(e){return e("/api/menus/:_id")}]);
angular.module("Foodees").factory("Order",["$resource",function(e){return e("/api/orders/:_id",{},{update:{method:"PUT"}})}]);
angular.module("Foodees").service("anchorSmoothScroll",[function(){this.scrollTo=function(o){function t(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function e(o){for(var t=document.getElementById(o),e=t.offsetTop,n=t;n.offsetParent&&n.offsetParent!=document.body;)n=n.offsetParent,e+=n.offsetTop;return e}var n=t(),r=e(o),u=r>n?r-n:n-r;if(100>u)return void scrollTo(0,r);var f=Math.round(u/100);f>=20&&(f=20);var c=Math.round(u/25),l=r>n?n+c:n-c,d=0;if(r>n)for(var i=n;r>i;i+=c)setTimeout("window.scrollTo(0, "+l+")",d*f),l+=c,l>r&&(l=r),d++;else for(var i=n;i>r;i-=c)setTimeout("window.scrollTo(0, "+l+")",d*f),l-=c,r>l&&(l=r),d++}}]).filter("trimid",[function(){return function(o){return o.substr(o.length-5)}}]).filter("roundup",[function(){return function(o){return Math.ceil(o)}}]).filter("rounddown",[function(){return function(o){return Math.round(o)}}]);
angular.module("Foodees").factory("Transaction",["$http",function(t){return{getWalletAmount:function(){return t.get("/api/balance")},getTransaction:function(n){return t.get("/api/transaction/"+n)},getTransactions:function(n){var a="/api/transactions";return n&&(a+="?type="+n),t.get(a)}}}]);